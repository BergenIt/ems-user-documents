# Quick Start Guide EMS v3.5.0

## Системные требования

### Требования к аппаратной части

Таблица 1. Системные требования к аппаратному обеспечению.

| № | Назначение ВМ | Количество ВМ | Количество vCPU | Количество ОЗУ | Дисковое пространство | Сетевые порты |
|---|---|---|---|---|--------------------|---|
| 1 | **Transport-node** | 1 | 4 | 6 Gb | 200 Gb (значение должно быть доступно `Системе` и приложению `docker`; объем пространства необходимого ОС не учитывается в заданном значении) | 1 |
| 2 | **Master-node** | 1 | 12 | 16 Gb | 100 Gb (значение должно быть доступно `Системе` и приложению `docker`; объем пространства необходимого ОС не учитывается в заданном значении) | 1 |
| 3 | **Tool-node** | 1 | 8 | 8 Gb | 50 Gb (значение должно быть доступно `Системе` и приложению `docker`; объем пространства необходимого ОС не учитывается в заданном значении) | 1 |

### Требования к операционной среде

Поддерживаемые ОС для функционирования серверной части Системы EMS:

-   Astra Linux 1.7;
-   Oracle 8.7 Server Minimal;
-   Ubuntu Linux 22.04;
-   Рэд ОС 7.3.

При этом, необходимо обеспечить:

-   Строгое соответствие по версиям ОС;
-   Использование одинаковых ОС для всех ВМ кластера.

### Требования к программному обеспечению

Перед началом установки на ВМ кластера должно быть развернуто прикладное ПО 
(строгое соответствие по версии):

-   docker 24.0.0.

## Размещение установочных файлов на серверах

```bash
scp -r ./ems-3.5.0.tar.gz root@{{ TRANSPORT_NODE_IP }}:~/ems-3.5.0.tar.gz
scp -r ./ems-3.5.0.tar.gz root@{{ MASTER_NODE_IP }}:~/ems-3.5.0.tar.gz
scp -r ./ems-3.5.0.tar.gz root@{{ TOOL_NODE_IP }}:~/ems-3.5.0.tar.gz
```

### Размещение файла лицензий на master-node

> <font color="red">**Внимание:** Файл лицензии необходимо разместить в директории инсталляционного пакета: `./ems-3.5.0/master_cluster/config/lics/`.</font>

```bash
scp ./lic.json root@{{ MASTER_NODE_IP }}:~/lic.json
```

## Проверка на соответствие системным требованиям перед выполнением установки

### Проверка Transport node

```bash
mkdir -p ~/ems-3.5.0
tar -xvf ~/ems-3.5.0.tar.gz -C ~/ems-3.5.0
mv -f ~/ems-3.5.0/bin/emsinstaller ~/ems-3.5.0/emsinstaller
chmod 0700 ~/ems-3.5.0/bin/*
chmod 0700 ~/ems-3.5.0/emsinstaller
~/ems-3.5.0/emsinstaller --mode check --cluster-role transport_cluster
```

### Проверка Master node

```bash
mkdir -p ~/ems-3.5.0
tar -xvf ~/ems-3.5.0.tar.gz -C ~/ems-3.5.0
mv -f ~/ems-3.5.0/bin/emsinstaller ~/ems-3.5.0/emsinstaller
mv -f ~/lic.json ~/ems-3.5.0/master_cluster/config/lics/lic.json
chmod 0700 ~/ems-3.5.0/bin/*
chmod 0700 ~/ems-3.5.0/emsinstaller
~/ems-3.5.0/emsinstaller --mode check --cluster-role master_cluster
```

### Проверка Tool node

```bash
mkdir -p ~/ems-3.5.0
tar -xvf ~/ems-3.5.0.tar.gz -C ~/ems-3.5.0
mv -f ~/ems-3.5.0/bin/emsinstaller ~/ems-3.5.0/emsinstaller
chmod 0700 ~/ems-3.5.0/bin/*
chmod 0700 ~/ems-3.5.0/emsinstaller
~/ems-3.5.0/emsinstaller --mode check --cluster-role tool_cluster
```

## Настройка фаерволла

> <font color="red">**Внимание:** Для правильной работы EMS на ВМ должен быть отключен системный firewall. Для ОС Ubuntu `ufw disable`. Для ОС Oracle `systemctl disable --now firewalld`.</font>

> <font color="red">**Внимание:** Актуально только для Рэд ОС - Очистить все правила пользовательских цепочек и разрешить исходящие, входящие и пересылаемые пакеты в IP Tables.</font>

```bash
iptables -F
iptables -X
iptables -t nat -F
iptables -t nat -X
iptables -t mangle -F
iptables -t mangle -X
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
```

После выключения фаервола требуется перезапустить службу Docker командой 
`systemctl restart docker`

## Конфигурирование инсталлятора

Перед началом установки необходимо заполнить конфигурацию инсталлятора EMS на 
основе окружения, созданного для развёртывания.

>Пример файла ems.config

```bash
# Необходимо указать DNS-имя сервера Master, по которому будет доступен интерфейс системы.  В случае отсутствия DNS вписать фейковый хостнейм.
DOMAIN_NAME=<Задайте_значение_согласно_инфраструктуре>
# Необходимо указать IP адрес ВМ tool-кластера.
NODE_IP=<Задайте_значение_согласно_инфраструктуре>
# Необходимо указать IP адрес ВМ сервера transport.
TRANSPORT_IP=<Задайте_значение_согласно_инфраструктуре>
# Необходимо указать DNS-имя сервера transport.
TRANSPORT_HOSTNAME=<Задайте_значение_согласно_инфраструктуре>
# Имя, на которое выдана лицензия (поле 'client_name' в json-файле).
CLIENT_NAME=<Задайте_значение_согласно_"client_name" в файле лицензии>
# Релиз устанавливаемой системы, не меняется.
APP_VERSION=3.5.0
# Каталог установки EMS, не меняется.
INSTDIR=/opt/ems/
# Локальный registry, не меняется.
REGISTRY=localhost:5000
# Отпечаток сертификата, при установке со стандартным сертификатом не меняется.
ACME_FINGERPRINT=22ed5de355d118ea440338e94f4d3b05903d526f8090636fa52c39b8b57c40ad
# Необходимо указать имя tool-кластера в системе EMS, при необходимости можно оставить стандартное значение. Допускаются символы [A-z] и [0-9]
CLUSTER=Core

```

> <font color="Sky Blue">**Совет:** т.к. описанные значения идентичны для всех нод кластера - скопируйте их в текстовый файл. Держите этот файл открытым в процессе инсталляции и копируйте значения на соответствующих шагах.</font>

## Установка **transport_cluster**

Запустите инсталлятор EMS и дождитесь окончания установки:

```bash
cd ~/ems-3.5.0
chmod 0700 ./emsinstaller
chmod 0700 ./bin/*
./emsinstaller --mode install --cluster-role transport_cluster
```

### Подтверждение корректности установки **transport_cluster**

Убедитесь в том, что приложение развёрнуто. Для этого выполните команду:

```bash
watch docker ps -a
```

В выводе контейнеры должны быть в состоянии `Up`.

> <font color="red">**Внимание:** Полной работоспособности приложение достигает в течение двух минут после запуска. В течение этого периода контейнеры могут быть несколько раз перезапущены.</font>

Выход из команды осуществляется нажатием сочетания клавиш `<CTRL> + C`.

## Установка **master_cluster**

Запустите инсталлятор EMS и дождитесь окончания установки:

```bash
chmod 0700 ./emsinstaller
chmod 0700 ./bin/*
./emsinstaller --mode install --cluster-role master_cluster
```

> Наличие предупреждений о незаданных переменных групп `LDAP_`, `SMTP_`, `SMPP_` или `TELEGRAM_` является нормальным поведением и не влияет на результат установки. Для настройки интеграции с внешними сервисами смотрите раздел "3.10 Настройка интеграции с внешними системами" в "Руководстве по инсталляции".

### Подтверждение корректности установки **master_cluster**

Убедитесь в том, что приложение развёрнуто. Для этого выполните команду:

```bash
watch docker ps -a
```

В выводе контейнеры должны быть в состоянии `Up`.

> <font color="red">**Внимание:** Полной работоспособности приложение достигает в течение двух минут после запуска. В течение этого периода контейнеры могут быть несколько раз перезапущены.</font>

Выход из команды осуществляется нажатием сочетания клавиш `<CTRL> + C`.

## Установка **tool_cluster**

Запустите инсталлятор EMS и дождитесь окончания установки:

```bash
chmod 0700 ./emsinstaller
chmod 0700 ./bin/*
./emsinstaller --mode install --cluster-role tool_cluster
```

### Подтверждение корректности установки **tool_cluster**

Убедитесь в том, что приложение развёрнуто. Для этого выполните команду:

```bash
watch docker ps -a
```

В выводе контейнеры должны быть в состоянии `Up`.

> <font color="red">**Внимание:** Полной работоспособности приложение достигает в течение двух минут после запуска. В течение этого периода контейнеры могут быть несколько раз перезапущены.</font>

Выход из команды осуществляется нажатием сочетания клавиш `<CTRL> + C`.

В случае успешного запуска система готова к эксплуатации. Для получения доступа 
используйте последнюю строку вывода `emsinstaller`, где содержатся стандартные 
логин, пароль и адрес доступа, например:

```bash
Веб-консоль EMS доступна по адресу https://ems.domain.name/ Стандартные логин, пароль: `SuperAdmin` `aA123123@`. 
```

Где вместо `адресу https://ems.domain.name/`, будет указано ваше доменное имя. В случае 
отсутствия доменного имени используйте IP-адрес master-cluster, например 
`https://192.168.1.12/`.
